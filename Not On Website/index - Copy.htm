<!DOCTYPE html>
<!--
 Example client script for JQUERY:AJAX -> PHP:MYSQL example
 From: http://openenergymonitor.org/emon/node/107
-->

<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Willingham PC Planning Applications</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
  </head>
  <body>

  <h1>Willingham PC Planning Applications</h1>
  <select name="street" id="street">
    <option value="*">all</option>
  </select>
  <hr />
  <div id="list">this element will be accessed by jquery and this text replaced</div>
  <hr />
  <div id="detail" style="display:none">this element will be accessed by jquery and this text replaced</div>

  <script id="source" language="javascript" type="text/javascript">

  // initialization
  $(function () 
  {
    // Send http request with AJAX (see http://api.jquery.com/jQuery.ajax/)
    $.ajax({                                      
      url: 'api.php',                  //the script to call to get data          
      data: "func=list",                        //you can insert url arguments here to pass to api.php
                                       //for example "id=5&parent=6"
      dataType: 'json',                //data format      
      success: function(data)          //on receipt of reply
      {
        var rows = "";
        
        for (var r=0; r<data.length; r++)
        {
          rows += "<b>id: </b><span class=\"app\">"+data[r]['id']+"</span><b> street: </b><span class=\"name\">"+data[r]['street']+"</span><b> number: </b>"+data[r]['number']+"<br>";
          $('#street').append($("<option></option>").attr("value",data[r]['id']).text(data[r]['street']));
        }
        $('#list').html(rows); //Set output element html
        
        // indicate that number is clickable
        $('.app').css("color","blue");

        // event handlers
        $('.app').click(function()
        {
          $('#detail').html("Object "+$(this).text()+" clicked").slideDown();
        });

        $('.name').click(function()
        {
          $.ajax({
            url: 'api.php',
            data: "func=street&name="+$(this).text(),
            dataType: 'json',
            success: function(data)
            {
              $('#detail').html("Street "+$(this).text()+" clicked, index "+data['id']).slideDown();
            }
          });
        });

        //recommend reading up on jquery selectors they are awesome http://api.jquery.com/category/selectors/
      },
      error: function(jqXHR,textStatus,errorThrown)          //on error
      {
        // Update html content
        $('#list').html("Whoops: " + textStatus + " " + errorThrown); //Set output element html
        //recommend reading up on jquery selectors they are awesome http://api.jquery.com/category/selectors/
      } 

    });
  }); 

  </script>
  </body>
</html>